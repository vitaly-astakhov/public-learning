# Server components

## Materials

- [RFC: React Server Components [github.com]](https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md)
- [RSC From Scratch. Part 1: Server Components](https://github.com/reactwg/server-components/discussions/5)
- [Making Sense of React Server Components](https://www.joshwcomeau.com/react/server-components/)

## Overview

Серверные компоненты (***server components***) позволяют разработчикам создавать приложения, объединяющие сервер и клиент, сочетая богатую интерактивность клиентских приложений с улучшенной производительностью традиционного серверного рендеринга:

- Серверные компоненты выполняются только на сервере и не оказывают никакого влияния на размер пакета. Их код никогда не загружается на клиентские серверы, что помогает уменьшить размер пакета и сократить время запуска. Подробнее: [Zero-Bundle-Size Components](https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md#zero-bundle-size-components), [Automatic Code Splitting](https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md#automatic-code-splitting)
- Серверные компоненты могут получать доступ к серверным источникам данных, таким как базы данных, файловые системы или (микро)сервисы. Подробнее: [Full Access to the Backend](https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md#full-access-to-the-backend)
- Серверные компоненты легко интегрируются с клиентскими компонентами, то есть с традиционными компонентами React.
- Серверные компоненты могут загружать данные на сервер и передавать их в качестве реквизита клиентским компонентам, позволяя клиенту обрабатывать рендеринг интерактивных частей страницы.
- Серверные компоненты могут динамически выбирать, какие клиентские компоненты отображать, что позволяет клиентам загружать только минимальный объем кода, необходимый для отображения страницы.
- Серверные компоненты сохраняют состояние клиента при перезагрузке. Это означает, что состояние клиента, фокус и даже текущая анимация не нарушаются и не сбрасываются при повторной загрузке дерева серверных компонентов.
- Серверные компоненты визуализируются постепенно, и пользовательский интерфейс передается клиенту в потоковом режиме. В сочетании с режимом ожидания (`Suspense`) это позволяет разработчикам создавать преднамеренные состояния загрузки и быстро показывать важный контент, ожидая загрузки оставшейся части страницы.
- Разработчики также могут совместно использовать код между сервером и клиентом, позволяя использовать один компонент для отображения статической версии некоторого контента на сервере по одному маршруту и редактируемой версии этого контента на клиенте по другому маршруту.

У серверных компонентов есть некоторые ограничения - например, они не могут использовать состояние или эффекты, - но в целом они работают так ожидается.

### [Capabilities & Constraints of Server and Client Components](https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md#capabilities--constraints-of-server-and-client-components)

- Серверные компоненты: Как правило, серверные компоненты запускаются *один раз для каждого запроса* на *сервере*, поэтому они не имеют состояния (*state*) и не могут использовать функции, которые существуют только на клиенте. В частности, серверные компоненты:
- ❌ Может не (*may not*) использовать state, поскольку они выполняются (концептуально) только один раз за запрос на сервере. Поэтому useState() и useReducer() не поддерживаются.
  - ❌ Может не (*may not*) использовать жизненный цикл рендеринга (эффекты). Таким образом, useEffect() и useLayoutEffect() не поддерживаются.
  - ❌ Могут (*may not*) не использоваться API-интерфейсы только для браузера, такие как DOM (если вы не заполните их на сервере).
  - ❌ Не может (*may not*) использовать пользовательские перехватчики, зависящие от состояния или эффектов, или служебные функции, зависящие от API-интерфейсов только для браузера.
  - ✅ Может (*may*) использовать async / await с источниками данных только для сервера, такими как базы данных, внутренние (микро) сервисы, файловые системы и т.д.
  - ✅ Может (*may*) отображать другие серверные компоненты, собственные элементы (div, span и т.д.) или клиентские компоненты.
  Серверные перехватчики/утилиты: Разработчики также могут создавать пользовательские перехватчики или служебные библиотеки, предназначенные для сервера. Применяются все правила для серверных компонентов. Например, одним из вариантов использования серверных перехватчиков является предоставление помощников для доступа к источникам данных на стороне сервера.
