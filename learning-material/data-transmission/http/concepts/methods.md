# Methods

Request method - часть request семантики и указывает на цель/действие, с которой клиент сделал этот запрос, и что ожидается клиентом в качестве успешного результата.
Request method вызывает действие, которое должно быть применено к целевому ресурсу.

Стандартные методы: GET, HEAD, POST, PUT, DELETE, CONNECT, OPTIONS, TRACE
Нестандартные, но зарегистрированные методы: [PATCH](https://www.rfc-editor.org/rfc/rfc5789), PRI (HTTP/2)

Полный список зарегистрированных методов запроса: https://www.iana.org/assignments/http-methods/http-methods.xhtml
___

Методы считаются "безопасными" (safe), если их семантика означает только доступ к чтению целевого ресурса. Безопасными методами являются: GET, HEAD, OPTIONS, and TRACE.
Цель проведения различия между безопасными и небезопасными методами состоит в том, чтобы позволить автоматизированным процессам поиска (spiders, web-crawlers) и оптимизации производительности кэша (предварительная выборка - pre-fetching) работать, не опасаясь причинения вреда.

Больше информации тут: https://www.rfc-editor.org/rfc/rfc9110#name-safe-methods
___
[Идемпотентный метод](https://www.rfc-editor.org/rfc/rfc9110#name-idempotent-methods) - это метод, который может быть вызван много раз без разных результатов. Не должно иметь значения, был ли метод вызван только один раз или более десяти раз. Результат всегда должен быть одинаковым.
Идемпотентными методами являются: PUT, DELETE. Так же идемпотентными методами считаются "безопасные" методы: GET, HEAD, OPTIONS, TRACE.

Метод POST не импотентный так как он обычно, но не обязательно, используются для создания нового ресурса на сервере. Таким образом, когда мы выполняем один и тот же POST запрос N-количество раз, у нас будет N-количество новых ресурсов на сервере.
___

### [OPTIONS](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.7) - ОПЦИИ
- Команда серверу: Опиши опции (_options_) взаимодействия с целевым ресурсом.
- Описание: Метод OPTIONS запрашивает сведения о параметрах (опциях) связи доступен для целевого ресурса, либо на сервере-источнике, либо на посредника. Этот метод позволяет клиенту определить параметры (опции) и/или требования, связанные с ресурсом или возможностями сервера, не подразумевая действия с ресурсом.
- Использование: используется для идентификации (узнавания) у сервера, какие другие методы, т.е. опции (_options_), он принимает.
- Возвращает: сервер ДОЛЖЕН вернуть любой заголовок (**header**), который может указывать на дополнительные функции (опции), реализованные сервером и применимые к целевому ресурсу (например, [Allow](https://www.rfc-editor.org/rfc/rfc9110#field.allow). Так же может вернуть и другие заголовки.
- Дополнения:
  <details><summary>Запрос OPTIONS со звездочкой  ("*" - asterisk form) в качестве цели запроса</summary>
  <p>

    Запрос OPTIONS со звездочкой ("*" - asterisk form) в качестве цели запроса ([Раздел 7.1](https://www.rfc-editor.org/rfc/rfc9110#target.resource)) применяется к серверу в целом, а не к специфического ресурса.
    Если целью запроса не является ("*" - asterisk form), применяется запрос _OPTIONS_ к опциям, которые доступны при общении с целевым ресурсом
    Источник: https://www.rfc-editor.org/rfc/rfc9110#section-9.3.7-2

    Не работает в **Fetch API**.
    Источники:
    - https://stackoverflow.com/a/75835604/14615230
    - https://github.com/whatwg/fetch/issues/1622

  </p>
  </details>

### [GET](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.1) - ПОЛУЧИТЬ
- Команда серверу: Перенесите текущее представление целевого ресурса.
- Описание: Метод _GET_ запрашивает у сервера-источника передачу текущего [выбранного представления](https://www.rfc-editor.org/rfc/rfc9110#selected.representation) для [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource)
- Возвращает: заголовки (**headers**), и содержимое (**content**) целевого ресурса.

### [HEAD](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.2) - ЗАГОЛОВКИ (я думаю, что название метода HEAD происходит от слова headers, то есть заголовки)
- Команда серверу: Перенесите текущее представление целевого ресурса, но без контента.
- Описание: Метод _HEAD_ запрашивает у сервера-источника передачу текущего [выбранного представления](https://www.rfc-editor.org/rfc/rfc9110#selected.representation) для [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource), без содержимого
- Возвращает: заголовки (**headers**), и НЕ ВОЗВРАЩАЕТ содержимое (**content**) целевого ресурса.

### [POST](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.3) - ОТПРАВИТЬ
- Команда серверу: Выполните обработку содержимого (**content**) запроса, зависящую от конкретного ресурса
- Описание: Метод _POST_ запрашивает, чтобы целевой ресурс обработал представление, заключенное в запросе
- Использование: Используется для отправки данных к определённому ресурсу сервера. Используется для создание нового ресурса, который еще не идентифицирован. Часто вызывает изменение состояния или какие-то побочные эффекты на сервере.
- Возвращает: заголовки (**headers**) и содержимое (**content**)

### [PUT](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.4) - ЗАМЕНИТЬ (перевод как-будто не совсем корректный)
- Команда серверу: замени все текущие представления (representation) целевого ресурса (target resource) содержимым (**content**) запроса.
- Описание: Метод _PUT_ запрашивает (**request**) у сервера-источника создание или замену состояния [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource) состоянием, определенным представлением в содержимое сообщения запроса.
- Использование:
  - Используется для замены текущих данных ресурсов сервера на новые, передаваемые запросом. То есть полностью заменяет запись на сервере.
  - Если ресурс в момента запроса (**request**) с методом _PUT_ не существует, то сервер-источник может создать такой ресурс и ДОЛЖЕН сообщить агенту пользователя (**user agent**), отправив ответ [201 (Created).](https://www.rfc-editor.org/rfc/rfc9110#status.201)
- Принимает: желаемое состояние [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource) , которое после успешного применения запроса _PUT_, заменит существующее состояние ресурса или создаст другой ресурс
- Возвращает: заголовки (**headers**) и содержимое (**content**)
- Дополнительно:
  - Метод PUT предполагает, что клиент знает, какой ресурс он хочет обновить. Если сервер не может обновить запрашиваемый ресурс и хочет, чтобы клиент обновил другой ресурс, например, если ресурс был перемещен на другой URI, то сервер ДОЛЖЕН отправить подходящий ответ с кодом 3xx (Redirection); клиент МОЖЕТ тогда сам решить, следует ли перенаправить запрос или нет.


### [PATCH](https://www.rfc-editor.org/rfc/rfc5789#section-2) - ИСПРАВЛЕНИЕ
- Описание: Метод _PATCH_ запрашивает (**request**) у сервера-источника изменение состояния [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource) состоянием, определенным представлением в содержимое сообщения запроса. В отличие от _PUT_, _PATCH_ применяется для  Этот метод содержит набор инструкций, описывающих, как изменить текущий ресурс для создания новой версии. Это можно сравнить с исправлением опечаток в книге, не заменяя всю книгу целиком.
- Использование:
  - Используется для частичного изменения ресурса сервера без замены всего ресурса. как это делает _PUT_.
  - Если ресурс в момента запроса (**request**) с методом _PATCH_ не существует, то сервер-источник может создать такой ресурс и ДОЛЖЕН сообщить агенту пользователя (**user agent**), отправив ответ [201 (Created).](https://www.rfc-editor.org/rfc/rfc9110#status.201)
 - Принимает: желаемое для замены состояние [целевого ресурса](https://www.rfc-editor.org/rfc/rfc9110#target.resource), которое после успешного применения запроса _PATCH_, частично обновит существующее состояние ресурса или создаст другой ресурс.
- Дополнительно:
  <details><summary>Тонкости</summary>
  <p>
  Clients need to choose when to use PATCH rather than PUT.  For
  example, if the patch document size is larger than the size of the
  new resource data that would be used in a PUT, then it might make
  sense to use PUT instead of PATCH.  A comparison to POST is even more
  difficult, because POST is used in widely varying ways and can
  encompass PUT and PATCH-like operations if the server chooses.  If
  the operation does not modify the resource identified by the Request-
  URI in a predictable way, POST should be considered instead of PATCH
  or PUT.

  Источник: https://www.rfc-editor.org/rfc/rfc5789#:~:text=Clients%20need%20to%20choose%20when,or%20PUT.
  </p>
  </details>
  <details><summary>Объяснение и пример от GPT4:</summary>
  <p>

  - PUT: Этот метод используется для полной замены ресурса на сервере. Если вы отправляете PUT-запрос, то вы предоставляете обновленную версию ресурса, которая полностью заменит текущую версию на сервере. Это похоже на то, как если бы вы заменили старую книгу на полке новым изданием.
  - PATCH: В отличие от PUT, PATCH применяется для частичного обновления ресурса. Этот метод содержит набор инструкций, описывающих, как изменить текущий ресурс для создания новой версии. Это можно сравнить с исправлением опечаток в книге, не заменяя всю книгу целиком.

  </p>
  </details>
  <details><summary>Заголовки, которые относятся только к PATCH</summary>
  <p>
  **[Accept-Patch](https://www.rfc-editor.org/rfc/rfc5789#section-3.1)** - Определяет принятые форматы исправлений для документов. Должен отправляться вместе с ответом (**response**) при вызове запроса с методом **_OPTIONS_**

  </p>
  </details>

### [DELETE](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.5) - УДАЛИТЬ
- Команда серверу: Удалите все текущие представления целевого ресурса.
- Описание: Метод DELETE запрашивает у сервера-источника  (**origin server**) удаление связи между [целевым ресурсом](https://www.rfc-editor.org/rfc/rfc9110#target.resource) и его текущей функциональностью.
- Использование:
  - Используется для удаления указанного ресурса сервера.

### [CONNECT](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.6) - СОЕДЕНИТЬ
- Команда серверу: Установите туннель к серверу, идентифицированному целевым ресурсом.
- Описание: Метод CONNECT запрашивает, чтобы получатель установил туннель к серверу (**origin server**) назначения, определенному в цели запроса (**request**), и, в случае успеха, впоследствии ограничил свое поведение слепой пересылкой данных в обоих направлениях, пока туннель не будет закрыт.
- Использование:
  - Используется для переключения соединение в туннельный режим вместо получения содержимого (**content**). [Источник](https://www.rfc-editor.org/rfc/rfc9110#section-6.4.1-7)
- Дополнительно:
  <details><summary>Обязательно использовать ":port" при создание цели запроса</summary>
  <p>

  CONNECT uses a special form of request target, unique to this method, consisting of only the host and port number of the tunnel destination, separated by a colon. There is no default port; a client MUST send the port number even if the CONNECT request is based on a URI reference that contains an authority component with an elided port ([Section 4.1](https://www.rfc-editor.org/rfc/rfc9110#uri.references)). For example,

    CONNECT server.example.com:80 HTTP/1.1
    Host: server.example.com

    A server MUST reject a CONNECT request that targets an empty or invalid port number, typically by responding with a 400 (Bad Request) status code

  </p>
  </details>
- Принимает: заголовки

### [TRACE](https://www.rfc-editor.org/rfc/rfc9110#section-9.3.8) - ОТСЛЕДИТЬ
- Команда серверу: Выполните проверку обратного цикла (loop-back test) передачи сообщений по пути к целевому ресурсу.
- Описание: Метод _TRACE_ запрашивает удаленный обратный цикл (loop-back) сообщения запроса на уровне приложения.
- Использование:
  - Метод _TRACE_ позволяет клиенту видеть, что он получает от другого конец цепочки запросов и использовать эти данные для тестирования или диагностики информация.
- Принимает: Принимает только заголовки (**headers**)
- Возвращает: Сервер ДОЛЖНЕН отразить (вернуть) полученное сообщение, исключая некоторые поля
 ____

[Все серверы должны поддерживать методы GET и HEAD. Остальные методы опциональные.](https://www.rfc-editor.org/rfc/rfc9110#section-9.1-9).

Методы: **CONNECT**, **TRACE** запрещены для использования в Fetch API. [Источник](https://fetch.spec.whatwg.org/#:~:text=A%20forbidden%20method,[HTTPVERBSEC3])

Список методов, которые разрешены целевым ресурсом, могут быть указаны в заголовке "Allow". Сервер (**origin server**) получающий метод запроса, который не распознан или не реализован, ДОЛЖЕН ответить 501 (Не реализован)

___

Самое важное: любая имлементация этих методов лежит на сервере. То есть, сервер свободен не использовать все методы. Он может, к примеру не использовать _PUT_ или _PATCH_, а использовать только _POST_ и отправлять необходимые статусы и ресурсы, в зависимости от переданного URI, заголовков и контента.

<details><summary>Пример запроса POST, который ведет себя как PUT запрос</summary>
<p>

Используется GitHub для обновления настроек репозитория.

![Screenshot 2024-02-27 231037](https://github.com/vitaliiastakhov/learning-private/assets/68643256/43900f3e-846c-4f18-b988-9d3c941f0581)
![Screenshot 2024-02-27 231344](https://github.com/vitaliiastakhov/learning-private/assets/68643256/1b8e4feb-5b4b-4536-a62e-7d16e320e1c2)

Мне не очень понятно зачем они так сделали. Надо будет изучить.

</p>
</details>

___

**todo:** Разобраться как правильно и лучше называть поля собщения‏ - заголовок (header) или поле (field). Всретил так же такое: [Request header field](https://www.rfc-editor.org/rfc/rfc9110#name-request-context-fields).
